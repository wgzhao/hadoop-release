Changes only in Hortonworks github and not in hadoop-2.6.0 and hence not covered by CHANGES.txt.

  INCOMPATIBLE CHANGES

  NEW FEATURES

    HDFS-6581. Support for writing to single replica in RAM.
    Applied HDFS-6581.merge.15.patch to Champlain. This is a consolidated
    patch containing all feature changes and was applied to trunk.
    (Multiple contributors via Arpit Agarwal)

    YARN-2837. Support TimeLine server to recover delegation token when
    restarting. (Zhijie Shen via jianhe)

    BUG-41349/YARN-2513. Host framework UIs in YARN for use with the ATS.
    (Jonathan Eagles via zjshen)

    HDFS-7604. Track and display failed DataNode storage locations
    in NameNode. (Contributed by Chris Nauroth)

  IMPROVEMENTS

    HDFS-7153. Add storagePolicy to NN edit log during file creation.
    (Arpit Agarwal).
    Cherry-picked commit ID 9e9e9cf from apache/trunk.

    HDFS-7093. Add config key to restrict setStoragePolicy. (Arpit Agarwal)
    Cherry-picked commit ID b38e52b from apache/trunk.

    HADOOP-9629. Support Windows Azure Storage - Blob as a file system in Hadoop.
    (Dexter Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David Lao,
    Mike Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys,
    Alexander Stojanovic, Brian Swan, and Min Wei via cnauroth)

    YARN-1979. TestDirectoryCollection fails when the umask is unusual.
    (Vinod Kumar Vavilapalli and Tsuyoshi OZAWA via junping_du)

    YARN-2190. Added CPU and memory limit options to the default container
    executor for Windows containers. (Chuan Liu via jianhe)

    MAPREDUCE-4815. Speed up FileOutputCommitter#commitJob for many output files.
    (Siqi Li via gera)

    HADOOP-11960. Enable Azure-Storage Client Side logging.
    (Dushyanth via cnauroth)

    HADOOP-10597. RPC Server signals backoff to clients when all request queues
    are full. (Ming Ma via Arpit Agarwal)

    YARN-3787. Allowed generic history service to load a number of applications whose
    started time is within the given range. (Xuan Gong via zjshen)

    HDFS-6917. Add an hdfs debug command to validate blocks, call
    recoverlease, etc. (Contributed by Colin Patrick McCabe)

    HDFS-7257. Add the time of last HA state transition to NN's /jmx page.
    (Contributed by Charles Lamb)

  BUG FIXES

    HDFS-27. HDFS CLI with --config set to default config complains log file not
    found error. (cnauroth)

    HADOOP-10839. Add unregisterSource() to MetricsSystem API.
    (Shanyu Zhao via cnauroth)

    HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File
    System. (Shanyu Zhao via cnauroth)

    HADOOP-10689. InputStream is not closed in
    AzureNativeFileSystemStore#retrieve(). (Chen He via cnauroth)

    HADOOP-10690. Lack of synchronization on access to InputStream in
    NativeAzureFileSystem#NativeAzureFsInputStream#close().
    (Chen He via cnauroth)

    HADOOP-10728. Metrics system for Windows Azure Storage Filesystem.
    (Dexter Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David Lao,
    Mike Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys,
    Alexander Stojanovich, Brian Swan, and Min Wei via cnauroth)

    HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File
    System. (Shanyu Zhao via cnauroth)

    HADOOP-10809. hadoop-azure: page blob support. (Dexter Bradshaw,
    Mostafa Elhemali, Eric Hanson, and Mike Liddell via cnauroth)

    HADOOP-11188. hadoop-azure: automatically expand page blobs when they become
    full. (Eric Hanson via cnauroth)

    HADOOP-11248. Add hadoop configuration to disable Azure Filesystem metrics
    collection. (Shanyu Zhao via cnauroth)

    YARN-2254. TestRMWebServicesAppsModification should run against both 
    CS and FS. (Zhihai Xu via kasha)

    HDFS-7503. Namenode restart after large deletions can cause slow
    processReport. (Arpit Agarwal)

    HDFS-7425. NameNode block deletion logging uses incorrect appender.
    (cnauroth)

    HADOOP-11321. copyToLocal cannot save a file to an SMB share unless the user
    has Full Control permissions. (cnauroth)

    HDFS-7514. TestTextCommand fails on Windows. (Arpit Agarwal)

    YARN-2917. Fixed potential deadlock when system.exit is called in
    AsyncDispatcher. (Rohith Sharmaks via jianhe)

    YARN-570. Time strings are formated in different timezone. (Akira Ajisaka
    and Peng Zhang via kasha)

    YARN-2964. RM prematurely cancels tokens for jobs that submit jobs (oozie)
    (Jian He via jlowe)

    HDFS-7443. BUG-29367. Datanode upgrade to BLOCKID_BASED_LAYOUT fails if
    duplicate block files are present in the same volume. (cmccabe)

    HDFS-7560. ACLs removed by removeDefaultAcl() will be back after NameNode
    restart/failover. (Vinayakumar B via cnauroth)

    BUG-26128/YARN-2571. RM to support YARN registry. Contributed by Steve
    Loughran.

    BUG-26133/YARN-2683. Service registry config options: document and move to
    core-default. Contributed by Steve Loughran.

    HDFS-7489. Incorrect locking in FsVolumeList#checkDirs can hang datanodes
    (Noah Lorang via Colin P. McCabe)

    YARN-3103. AMRMClientImpl does not update AMRM token properly. (Jason Lowe
    via jianhe)

    MAPREDUCE-6230. Fixed RMContainerAllocator to update the new AMRMToken
    service name properly. Contributed by Jason Lowe

    HADOOP-11509. change parsing sequence in GenericOptionsParser to parse
    -D parameters before -files. (xgong)

    HADOOP-11523. StorageException complaining " no lease ID" when updating
    FolderLastModifiedTime in WASB. (Duo Xu via cnauroth)

    BUG-31164. HDFS-7733. NFS: readdir/readdirplus return null directory
    attribute on failure.

    YARN-2246. Made the proxy tracking URL always be
    http(s)://proxy addr:port/proxy/<appId> to avoid duplicate sections. (Devaraj
    K via zjshen)

    HDFS-7714. Simultaneous restart of HA NameNodes and DataNode can cause
    DataNode to register successfully with only one NameNode.(vinayakumarb)

    HDFS-7611. deleteSnapshot and delete of a file can leave orphaned blocks
    in the blocksMap on NameNode restart. (jing9)

    YARN-3207. Secondary filter matches entites which do not have the key being
    filtered for. (Zhijie Shen via xgong)

    HDFS-7009. Active NN and standby NN have different live nodes.
    (Ming Ma via cnauroth)

    HADOOP-11629. WASB filesystem should not start BandwidthGaugeUpdater if
    fs.azure.skip.metrics set to true. (Shanyu Zhao via cnauroth)

    HDFS-7831. Fix the starting index and end condition of the loop in
    FileDiffList.findEarlierSnapshotBlocks(). (Konstantin Shvachko via jing9)

    YARN-3239. WebAppProxy does not support a final tracking url which has
    query fragments and params (Jian He via jlowe)

    YARN-42. Yarn.nodemanager.remote-app-log-dir could not be configured to fully
    qualified path. (xgong)

    BUG-32378. NN went down during RB test due to storage version mismatch.
    (jing9)

    HDFS-7855. Datanode should not trust the generation stamp provided by
    client. (Tsz Wo Nicholas Sze)

    YARN-3227. Timeline renew delegation token fails when RM user's TGT is expired
    (Zhijie Shen via xgong)

    HADOOP-11642. Upgrade azure sdk version from 0.6.0 to 2.0.0.
    (Shashank Khandelwal and Ivan Mitic via cnauroth)

    HADOOP-11693. Azure Storage FileSystem rename operations are throttled too
    aggressively to complete HBase WAL archiving. (Duo Xu via cnauroth)

    YARN-3393. Getting application(s) goes wrong when app finishes before
    starting the attempt. (Zhijie Shen via xgong)

    HDFS-8072. Reserved RBW space is not released if client terminates
    while writing block. (Arpit Agarwal)

    MAPREDUCE-6275. Race condition in FileOutputCommitter v2 for user-specified
    task output subdirs. Contributed by Gera Shegalov and Siqi Li

    HDFS-8127. NameNode Failover during HA upgrade can cause DataNode to finalize
    upgrade. (jing9)

    HDFS-7035. Make adding a new data directory to the DataNode an atomic
    operation and improve error handling (Lei Xu via Colin P. McCabe)

    HDFS-7575. Upgrade should generate a unique storage ID for each
    volume. (Arpit Agarwal)

    HDFS-7596. NameNode should prune dead storages from storageMap.
    (Arpit Agarwal via cnauroth)

    HDFS-7579. Improve log reporting during block report rpc failure.
    (Charles Lamb via cnauroth)

    HDFS-7960. The full block report should prune zombie storages even if
    they're not empty. (cmccabe and Eddy Xu via wang)

    YARN-2906. CapacitySchedulerPage shows HTML tags for a queue's Active Users.
    Contributed by Jason Lowe

    YARN-2905. AggregatedLogsBlock page can infinitely loop if the aggregated
    log file is corrupted

    YARN-2414. RM web UI: app page will crash if app is failed before any
    attempt has been created. Contributed by Wangda Tan

    YARN-2992. ZKRMStateStore crashes due to session expiry. Contributed by
    Karthik Kambatla

    YARN-2340. Fixed NPE when queue is stopped during RM restart. Contributed
    by Rohith Sharmaks

    YARN-2874. Dead lock in DelegationTokenRenewer which blocks RM to execute
    any further apps. (Naganarasimha G R via kasha)

    YARN-2816. NM fail to start with NPE during container recovery.
    (Zhihai Xu via jlowe)

    HDFS-7587 [BUG-35869]. Edit log corruption can happen if append fails with
    a quota violation. (Rewrite of HDFS-7587 fix for 2.2. jing9 via
    Arpit Agarwal)

    HADOOP-11959. WASB should configure client side socket timeout in storage
    client blob request options. (Ivan Mitic via cnauroth)

    MAPREDUCE-6361. NPE issue in shuffle caused by concurrent issue between
    copySucceeded() in one thread and copyFailed() in another thread on the
    same host. (Junping Du via ozawa)

    YARN-3700. Made generic history service load a number of latest applications
    according to the parameter or the configuration. (Xuan Gong via zjshen)

    HDFS-7609. Avoid retry cache collision when Standby NameNode loading edits.
    (Ming Ma via jing9)

    YARN-3764. CapacityScheduler should forbid moving LeafQueue from one parent
    to another. (Wangda Tan via jianhe)

    HADOOP-12073. Azure FileSystem PageBlobInputStream does not return -1 on
    EOF. (Ivan Mitic via cnauroth)

    HDFS-8767. RawLocalFileSystem.listStatus() returns null for UNIX pipefile.
    (kanaka kumar avvaru via wheat9)

    YARN-2922. ConcurrentModificationException in CapacityScheduler's LeafQueue.
    (Rohith Sharmaks via ozawa)

    YARN-2019/EAR-1682. Retrospect on decision of making RM crashed if any
    exception throw in ZKRMStateStore.
    Contributed by Rohith Sharma K S

    YARN-3487. CapacityScheduler scheduler lock obtained unnecessarily 
    when calling getQueue. Contributed by Jason Lowe.

    HDFS-8486. DN startup may cause severe data loss. Contributed by Daryn
    Sharp.

    HDFS-8270. create() always retried with hardcoded timeout when file
    already exists with open lease. (J.Andreina via vianayakumarb)

    YARN-3878. AsyncDispatcher can hang while stopping if it is configured for
    draining events on stop. (Varun Saxena via jianhe)

    YARN-3385. Fixed a race-condition in ResourceManager's ZooKeeper based
    state-store to avoid crashing on duplicate deletes. (Zhihai Xu via vinodkv)

    YARN-2136. Changed RMStateStore to ignore store opearations when fenced.
    (Varun Saxena via jianhe)

    YARN-2856. Fixed RMAppImpl to handle ATTEMPT_KILLED event at ACCEPTED state
    on app recovery. (Rohith Sharmaks via jianhe)

    YARN-2946. Fixed potential deadlock in RMStateStore. (Rohith Sharmaks via
    jianhe)

    YARN-2992. ZKRMStateStore crashes due to session expiry. (Karthik Kambatla
    via jianhe)

    YARN-3094. Reset timer for liveness monitors after RM recovery. (Jun Gong
    via jianhe)

    YARN-3369. Missing NullPointer check in AppSchedulingInfo causes RM to die.
    (Brahma Reddy Battula via wangda)

    YARN-3753. RM failed to come up with "java.io.IOException: Wait for
    ZKClient creation timed out‚Äù. (Jian He via xgong)

    YARN-3242. Asynchrony in ZK-close can lead to ZKRMStateStore watcher
    receiving events for old client. (Zhihai Xu via kasha)
    
    YARN-3469. ZKRMStateStore: Avoid setting watches that are not required. 
    (Jun Gong via kasha)

    YARN-2605. RM HA Rest api endpoints doing redirect incorrectly.
    (Xuan Gong via stevel)

    YARN-3351. AppMaster tracking URL is broken in HA. (Anubhav Dhoot via kasha)

    YARN-3526. ApplicationMaster tracking URL is incorrectly redirected on
    a QJM cluster. (Weiwei Yang via xgong)
    
    YARN-3804. Both RM are on standBy state when kerberos user not in yarn.admin.acl
    (Varun Saxena via xgong)
    
    YARN-2865. Fixed RM to always create a new RMContext when transtions from
    StandBy to Active. (Rohith Sharmaks via jianhe)

    YARN-2713. "RM Home" link in NM should point to one of the RMs in an 
    HA setup. (kasha)

    HADOOP-12186. ActiveStandbyElector shouldn't call monitorLockNodeAsync
    multiple times (Contributed by zhihai xu)
    
    HDFS-8856. [2.2] Make LeaseManager#countPath O(1). (Arpit Agarwal)

    BUG-41834. DFSOutputstreamer does not log failed pipeline status.
    (Arpit Agarwal)

    HDFS-7980. Incremental BlockReport will dramatically slow down the startup of
    a namenode. Contributed by Walter Su.

    HDFS-7734. Class cast exception in NameNode#main. (Contriubuted by Yi Liu)

    BUG-42160. Backport HDFS-7712 to 2.2-maint. (Xiaobing Zhou)

    BUG-42484. Backport HDFS-8522 to 2.2-maint, Change heavily recorded NN logs
    from INFO to DEBUG level. (Xiaobing Zhou)

    BUG-42253. HDFS-8880. NameNode metrics logging. (Arpit Agarwal)

    BUG-41706. HDFS-5782 (BlockListAsLongs should take lists of Replicas rather than
    concrete classes) and HDFS-7435 (PB encoding of block reports is very inefficient).

    HDFS-7278. Add a command that allows sysadmins to manually trigger full block reports
    from a DN (cmccabe).

    HDFS-7704. DN heartbeat to Active NN may be blocked and expire if connection to
    Standby NN continues to time out. Contributed by Rushabh Shah.

    HDFS-8163. Using monotonicNow for block report scheduling causes test failures on
    recently restarted systems. (Arpit Agarwal)

    HDFS-7635. Remove TestCorruptFilesJsp from branch-2. (Chris Nauroth)

    HDFS-7632. MiniDFSCluster configures DataNode data directories incorrectly
    if using more than 1 DataNode and more than 2 storage locations per
    DataNode. (Chris Nauroth)

    HDFS-8863. The remaining space check in BlockPlacementPolicyDefault is
    flawed. (Kihwal Lee via Yi Liu)

    HDFS-7915. The DataNode can sometimes allocate a ShortCircuitShm slot and
    fail to tell the DFSClient about it because of a network error. (Colin
    Patrick McCabe)

    HDFS-8070. Pre-HDFS-7915 DFSClient cannot use short circuit on
    post-HDFS-7915 DataNode. (Colin Patrick McCabe)

