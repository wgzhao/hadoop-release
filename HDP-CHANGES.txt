Changes only in Hortonworks github and not in hadoop-2.6.0 and hence not
covered by CHANGES.txt.

  INCOMPATIBLE CHANGES

  NEW FEATURES

    YARN-4233. YARN Timeline Service plugin: ATS v1.5 (Multiple contributors)

    HDFS-6581. Support for writing to single replica in RAM. Applied
    HDFS-6581.merge.15.patch to Champlain. This is a consolidated patch
    containing all feature changes and was applied to trunk. (Multiple
    contributors via Arpit Agarwal)

    YARN-2837. Support TimeLine server to recover delegation token when
    restarting. (Zhijie Shen via jianhe)

    YARN-2513. Host framework UIs in YARN for use with the ATS. (Jonathan
    Eagles via zjshen)

    HDFS-3107. Introduce truncate. (Plamen Jeliazkov via shv)

    HDFS-7056. Snapshot support for truncate. (Plamen Jeliazkov and shv)

    HDFS-6673. Add delimited format support to PB OIV tool. (Eddy Xu via wang)

    HDFS-7655. Expose truncate API for Web HDFS. (yliu)

    HDFS-7604. Track and display failed DataNode storage locations in NameNode.
    (Contributed by Chris Nauroth)

    HDFS-8969. Clean up findbugs warnings for HDFS-8823 and HDFS-8932.
    Contributed by Anu Engineer.

    HDFS-8932. NPE thrown in NameNode when try to get TotalSyncCount metric
    before editLogStream initialization. Contributed by Surendra Singh Lilhore

    HDFS-8911. NameNode Metric : Add Editlog counters as a JMX metric.
    (Contributed by Anu Engineer)

    HDFS-6982. nntop: top­-like tool for name node users. (Maysam Yabandeh via
    wang)

    HDFS-6663. Admin command to track file and locations from block id. (Chen
    He via kihwal)

    HADOOP-7984. Add hadoop --loglevel option to change log level. (Akira
    AJISAKA via cnauroth)

    HADOOP-11490. Expose truncate API via FileSystem and shell command. (Milan
    Desai via shv)

    HADOOP-11510. Expose truncate API via FileContext. (yliu)

    HADOOP-10987. Provide an iterator-based listing API for FileSystem (kihwal)

    BUG-43229. HADOOP-12358. Add -safely flag to rm to prompt when deleting
    many files. (xyao).

    BUG-43224. HDFS-8155. Support OAuth2 in WebHDFS. (jghoman)

    BUG-44447. HDFS-9184. Logging HDFS operation's caller context into audit
    logs (Mingliang Liu via jitendra)

    BUG-44457. YARN should log caller context into its audit logs for app
    submissions. (Wangda Tan via jianhe)

    BUG-46647. Enable caller context feature by default. (Mingliang liu)

    BUG-44184. HDFS-4015. Safemode should count and report orphaned blocks.
    (Contributed by Anu Engineer)

  IMPROVEMENTS

    HDFS-7153. Add storagePolicy to NN edit log during file creation. (Arpit
    Agarwal). Cherry-picked commit ID 9e9e9cf from apache/trunk.

    HDFS-7093. Add config key to restrict setStoragePolicy. (Arpit Agarwal)
    Cherry-picked commit ID b38e52b from apache/trunk.

    HADOOP-9629. Support Windows Azure Storage - Blob as a file system in
    Hadoop. (Dexter Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David
    Lao, Mike Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys,
    Alexander Stojanovic, Brian Swan, and Min Wei via cnauroth)

    YARN-1979. TestDirectoryCollection fails when the umask is unusual. (Vinod
    Kumar Vavilapalli and Tsuyoshi OZAWA via junping_du)

    YARN-2190. Added CPU and memory limit options to the default container
    executor for Windows containers. (Chuan Liu via jianhe)

    MAPREDUCE-4815. Speed up FileOutputCommitter#commitJob for many output
    files. (Siqi Li via gera)

    HADOOP-11960. Enable Azure-Storage Client Side logging. (Dushyanth via
    cnauroth)

    HADOOP-10597. RPC Server signals backoff to clients when all request queues
    are full. (Ming Ma via Arpit Agarwal)

    YARN-3787. Allowed generic history service to load a number of applications
    whose started time is within the given range. (Xuan Gong via zjshen)

    HDFS-7470. SecondaryNameNode need twice memory when calling
    reloadFromImageFile. (zhaoyunjiong via cnauroth)

    HDFS-7606. Fix potential NPE in INodeFile.getBlocks(). (Byron Wong via shv)

    HDFS-7738. Revise the exception message for recover lease; add more
    truncate tests such as truncate with HA setup, negative tests, truncate
    with other operations and multiple truncates.  (szetszwo)

    HDFS-7058. Tests for truncate CLI. (Dasha Boudnik via shv)

    HDFS-7760. Document truncate for WebHDFS. (shv)

    HDFS-7531. Improve the concurrent access on FsVolumeList (Lei Xu via Colin
    P. McCabe)

    HADOOP-11648. Set DomainSocketWatcher thread name explicitly. (Liang Xie
    via ozawa)

    HDFS-7706. Switch BlockManager logging to use slf4j. (wang)

    HDFS-7491. Add incremental blockreport latency to DN metrics. Contributed
    by Ming Ma.

    HDFS-6860. BlockStateChange logs are too noisy. (Chang Li and xyao via
    xyao)

    HDFS-7890. Improve information on Top users for metrics in
    RollingWindowsManager and lower log level (J.Andreina via vinayakumarb)

    HDFS-7457. DatanodeID generates excessive garbage. (daryn via kihwal)

    HDFS-7213. processIncrementalBlockReport performance degradation. (Eric
    Payne via kihwal)

    HDFS-7222. Expose DataNode network errors as a metric. (Charles Lamb via
    wang)

    HDFS-6917. Add an hdfs debug command to validate blocks, call recoverlease,
    etc. (Contributed by Colin Patrick McCabe)

    HDFS-7257. Add the time of last HA state transition to NN's /jmx page.
    (Contributed by Charles Lamb)

    HDFS-8983. NameNode support for protected directories. (Arpit Agarwal)

    HDFS-7035. Make adding a new data directory to the DataNode an atomic
    operation and improve error handling (Lei Xu via Colin P. McCabe)

    HDFS-7398. Reset cached thread-local FSEditLogOp's on every
    FSEditLog#logEdit. (Gera Shegalov via cnauroth)

    HDFS-7426. Change nntop JMX format to be a JSON blob. (wang)

    HDFS-7182. JMX metrics aren't accessible when NN is busy. (Ming Ma via
    jing9)

    HADOOP-11238. Update the NameNode's Group Cache in the background when
    possible (Chris Li via Colin P. McCabe)

    HADOOP-11579. Documentation for truncate. (shv)

    HADOOP-11441. Hadoop-azure: Change few methods scope to public. (Shashank
    Khandelwal via cnauroth)

    HADOOP-9137. Support connection limiting in IPC server (kihwal)

    HADOOP-11498. Bump the version of HTrace to 3.1.0-incubating (Masatake
    Iwasaki via Colin P. McCabe)

    HADOOP-11442. hadoop-azure: Create test jar. (Shashank Khandelwal via
    cnauroth)

    HADOOP-11430. Add GenericTestUtils#disableLog, GenericTestUtils#setLogLevel
    (cmccabe)

    HADOOP-11390 Metrics 2 ganglia provider to include hostname in unresolved
    address problems. (Varun Saxena via stevel)

    HADOOP-11291. Log the cause of SASL connection failures. (Stephen Chu via
    cnauroth)

    HADOOP-10786. Fix UGI#reloginFromKeytab on Java 8. (Stephen Chu via wheat9)

    HADOOP-12325. RPC Metrics : Add the ability track and log slow RPCs. (Anu
    Engineer via xyao)

    BUG-44428. HADOOP-12413. AccessControlList should avoid calling
    getGroupNames in isUserInList with empty groups. (Zhihai Xu via cnauroth)

    BUG-44026. HDFS-9109. Adding informative message to sticky bit permission
    denied exception. (xyao)

    BUG-43226. HDFS-8435. Support CreateFlag in WebHdfs. (Jakob Homan via
    cdouglas)

    BUG-43598. computeReplicationWork does not record all failure paths. (Arpit
    Agarwal)

    BUG-43799. HDFS-8542. WebHDFS getHomeDirectory behavior does not match
    specification. (Kanaka Kumar Avvaru via jghoman)

    BUG-43895. HDFS-8797. WebHdfsFileSystem creates too many connections for
    pread. (jing9)

    YARN-4243. Add retry on establishing Zookeeper conenction in
    EmbeddedElectorService#serviceInit. (Xuan Gong via junping_du)

    BUG-43227. HDFS-8885. ByteRangeInputStream used in webhdfs does not
    override available(). (Shradha Revankar via aajisaka)

    BUG-43766. HDFS-8180. AbstractFileSystem Implementation for WebHdfs.
    (Santhosh Nayak via cnauroth)

    BUG-44034. HDFS-9112. Improve error message for Haadmin when multiple name
    service IDs are configured. (Anu Engineer via jing9)

    BUG-44480. HDFS-9082. Change the log level in
    WebHdfsFileSystem.initialize() from INFO to DEBUG. (Santhosh Nayak via
    cnauroth)

    BUG-45430. HDFS-9175. Change scope of
    'AccessTokenProvider.getAccessToken()' and
    'CredentialBasedAccessTokenProvider.getCredential()' abstract methods to
    public. (Santhosh Nayak via cnauroth).

    BUG-45263. HADOOP-12437. Allow SecurityUtil to lookup alternate hostnames.
    (Arpit Agarwal)

    BUG-44333. HDFS-8384. Allow NN to startup if there are files having a lease
    but are not under construction (jing9)

    RMP-3532. HDFS-7858. Improve HA Namenode Failover detection on the client.
    (Arun Suresh)

    BUG-43341. HDFS-8965. Harden edit log reading code against out of memory
    errors. (cmccabe)

    BUG-45721. HADOOP-12350. WASB Logging: Improve WASB Logging around deletes,
    reads and writes. (Dushyanth via cnauroth)

  OPTIMIZATIONS

  BUG FIXES

    HDFS-27. HDFS CLI with --config set to default config complains log file
    not found error. (cnauroth)

    HADOOP-10839. Add unregisterSource() to MetricsSystem API. (Shanyu Zhao via
    cnauroth)

    HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File
    System. (Shanyu Zhao via cnauroth)

    HADOOP-10689. InputStream is not closed in
    AzureNativeFileSystemStore#retrieve(). (Chen He via cnauroth)

    HADOOP-10690. Lack of synchronization on access to InputStream in
    NativeAzureFileSystem#NativeAzureFsInputStream#close(). (Chen He via
    cnauroth)

    HADOOP-10728. Metrics system for Windows Azure Storage Filesystem. (Dexter
    Bradshaw, Mostafa Elhemali, Xi Fang, Johannes Klein, David Lao, Mike
    Liddell, Chuan Liu, Lengning Liu, Ivan Mitic, Michael Rys, Alexander
    Stojanovich, Brian Swan, and Min Wei via cnauroth)

    HADOOP-10840. Fix OutOfMemoryError caused by metrics system in Azure File
    System. (Shanyu Zhao via cnauroth)

    HADOOP-10809. hadoop-azure: page blob support. (Dexter Bradshaw, Mostafa
    Elhemali, Eric Hanson, and Mike Liddell via cnauroth)

    HADOOP-11188. hadoop-azure: automatically expand page blobs when they
    become full. (Eric Hanson via cnauroth)

    HADOOP-11248. Add hadoop configuration to disable Azure Filesystem metrics
    collection. (Shanyu Zhao via cnauroth)

    YARN-2254. TestRMWebServicesAppsModification should run against both CS and
    FS. (Zhihai Xu via kasha)

    HDFS-7503. Namenode restart after large deletions can cause slow
    processReport. (Arpit Agarwal)

    HDFS-7425. NameNode block deletion logging uses incorrect appender.
    (cnauroth)

    HADOOP-11321. copyToLocal cannot save a file to an SMB share unless the
    user has Full Control permissions. (cnauroth)

    HDFS-7514. TestTextCommand fails on Windows. (Arpit Agarwal)

    YARN-2917. Fixed potential deadlock when system.exit is called in
    AsyncDispatcher. (Rohith Sharmaks via jianhe)

    YARN-570. Time strings are formated in different timezone. (Akira Ajisaka
    and Peng Zhang via kasha)

    YARN-2964. RM prematurely cancels tokens for jobs that submit jobs (oozie)
    (Jian He via jlowe)

    HDFS-7443. BUG-29367. Datanode upgrade to BLOCKID_BASED_LAYOUT fails if
    duplicate block files are present in the same volume. (cmccabe)

    HDFS-7560. ACLs removed by removeDefaultAcl() will be back after NameNode
    restart/failover. (Vinayakumar B via cnauroth)

    BUG-26128/YARN-2571. RM to support YARN registry. Contributed by Steve
    Loughran.

    BUG-26133/YARN-2683. Service registry config options: document and move to
    core-default. Contributed by Steve Loughran.

    HDFS-7489. Incorrect locking in FsVolumeList#checkDirs can hang datanodes
    (Noah Lorang via Colin P. McCabe)

    YARN-3103. AMRMClientImpl does not update AMRM token properly. (Jason Lowe
    via jianhe)

    MAPREDUCE-6230. Fixed RMContainerAllocator to update the new AMRMToken
    service name properly. Contributed by Jason Lowe

    HADOOP-11509. change parsing sequence in GenericOptionsParser to parse -D
    parameters before -files. (xgong)

    HADOOP-11523. StorageException complaining " no lease ID" when updating
    FolderLastModifiedTime in WASB. (Duo Xu via cnauroth)

    BUG-31164. HDFS-7733. NFS: readdir/readdirplus return null directory
    attribute on failure.

    YARN-2246. Made the proxy tracking URL always be http(s)://proxy
    addr:port/proxy/<appId> to avoid duplicate sections. (Devaraj K via zjshen)

    HDFS-7714. Simultaneous restart of HA NameNodes and DataNode can cause
    DataNode to register successfully with only one NameNode.(vinayakumarb)

    HDFS-7611. deleteSnapshot and delete of a file can leave orphaned blocks in
    the blocksMap on NameNode restart. (jing9)

    YARN-3207. Secondary filter matches entites which do not have the key being
    filtered for. (Zhijie Shen via xgong)

    HDFS-7009. Active NN and standby NN have different live nodes. (Ming Ma via
    cnauroth)

    HADOOP-11629. WASB filesystem should not start BandwidthGaugeUpdater if
    fs.azure.skip.metrics set to true. (Shanyu Zhao via cnauroth)

    HDFS-7831. Fix the starting index and end condition of the loop in
    FileDiffList.findEarlierSnapshotBlocks(). (Konstantin Shvachko via jing9)

    YARN-3239. WebAppProxy does not support a final tracking url which has
    query fragments and params (Jian He via jlowe)

    YARN-42. Yarn.nodemanager.remote-app-log-dir could not be configured to
    fully qualified path. (xgong)

    BUG-32378. NN went down during RB test due to storage version mismatch.
    (jing9)

    HDFS-7855. Datanode should not trust the generation stamp provided by
    client. (Tsz Wo Nicholas Sze)

    YARN-3227. Timeline renew delegation token fails when RM user's TGT is
    expired (Zhijie Shen via xgong)

    HADOOP-11642. Upgrade azure sdk version from 0.6.0 to 2.0.0. (Shashank
    Khandelwal and Ivan Mitic via cnauroth)

    HADOOP-11693. Azure Storage FileSystem rename operations are throttled too
    aggressively to complete HBase WAL archiving. (Duo Xu via cnauroth)

    YARN-3393. Getting application(s) goes wrong when app finishes before
    starting the attempt. (Zhijie Shen via xgong)

    HDFS-8072. Reserved RBW space is not released if client terminates while
    writing block. (Arpit Agarwal)

    MAPREDUCE-6275. Race condition in FileOutputCommitter v2 for user-specified
    task output subdirs. Contributed by Gera Shegalov and Siqi Li

    HDFS-8127. NameNode Failover during HA upgrade can cause DataNode to
    finalize upgrade. (jing9)

    HDFS-7035. Make adding a new data directory to the DataNode an atomic
    operation and improve error handling (Lei Xu via Colin P. McCabe)

    HDFS-7707. Edit log corruption due to delayed block removal again. (Yongjun
    Zhang via kihwal)

    HDFS-7263. Snapshot read can reveal future bytes for appended files. (Tao
    Luo via shv)

    HDFS-3443. Fix NPE when namenode transition to active during startup by
    adding checkNNStartup() in NameNodeRpcServer.  (Vinayakumar B via szetszwo)

    HDFS-7575. Upgrade should generate a unique storage ID for each volume.
    (Arpit Agarwal)

    HDFS-7596. NameNode should prune dead storages from storageMap. (Arpit
    Agarwal via cnauroth)

    HDFS-7579. Improve log reporting during block report rpc failure. (Charles
    Lamb via cnauroth)

    HDFS-4882. Prevent the Namenode's LeaseManager from looping forever in
    checkLeases (Ravi Prakash via Colin P. McCabe)

    HDFS-7960. The full block report should prune zombie storages even if
    they're not empty. (cmccabe and Eddy Xu via wang)

    YARN-2906. CapacitySchedulerPage shows HTML tags for a queue's Active
    Users. Contributed by Jason Lowe

    YARN-2905. AggregatedLogsBlock page can infinitely loop if the aggregated
    log file is corrupted

    YARN-2414. RM web UI: app page will crash if app is failed before any
    attempt has been created. Contributed by Wangda Tan

    YARN-2992. ZKRMStateStore crashes due to session expiry. Contributed by
    Karthik Kambatla

    YARN-2340. Fixed NPE when queue is stopped during RM restart. Contributed
    by Rohith Sharmaks

    YARN-2874. Dead lock in DelegationTokenRenewer which blocks RM to execute
    any further apps. (Naganarasimha G R via kasha)

    YARN-2816. NM fail to start with NPE during container recovery. (Zhihai Xu
    via jlowe)

    HDFS-7587 [BUG-35869]. Edit log corruption can happen if append fails with
    a quota violation. (Rewrite of HDFS-7587 fix for 2.2. jing9 via Arpit
    Agarwal)

    HDFS-7638: Small fix and few refinements for FSN#truncate. (yliu)

    HDFS-7634. Disallow truncation of Lazy persist files. (Yi Liu via Arpit
    Agarwal)

    HDFS-7643. Test case to ensure lazy persist files cannot be truncated. (Yi
    Liu via Arpit Agarwal)

    HDFS-7659. truncate should check negative value of the new length. (Yi Liu
    via shv)

    HDFS-7676. Fix TestFileTruncate to avoid bug of HDFS-7611. (shv)

    HDFS-7677. DistributedFileSystem#truncate should resolve symlinks. (yliu)

    HDFS-7843. A truncated file is corrupted after rollback from a rolling
    upgrade.  (szetszwo)

    HDFS-7926. NameNode implementation of ClientProtocol.truncate(..) is not
    idempotent (Tsz Wo Nicholas Sze via brandonli)

    HDFS-7999. FsDatasetImpl#createTemporary sometimes holds the FSDatasetImpl
    lock for a very long time (sinago via cmccabe)

    HADOOP-11959. WASB should configure client side socket timeout in storage
    client blob request options. (Ivan Mitic via cnauroth)

    MAPREDUCE-6361. NPE issue in shuffle caused by concurrent issue between
    copySucceeded() in one thread and copyFailed() in another thread on the
    same host. (Junping Du via ozawa)

    YARN-3700. Made generic history service load a number of latest
    applications according to the parameter or the configuration. (Xuan Gong
    via zjshen)

    HDFS-7609. Avoid retry cache collision when Standby NameNode loading edits.
    (Ming Ma via jing9)

    YARN-3764. CapacityScheduler should forbid moving LeafQueue from one parent
    to another. (Wangda Tan via jianhe)

    HADOOP-12073. Azure FileSystem PageBlobInputStream does not return -1 on
    EOF. (Ivan Mitic via cnauroth)

    HDFS-8767. RawLocalFileSystem.listStatus() returns null for UNIX pipefile.
    (kanaka kumar avvaru via wheat9)

    YARN-2922. ConcurrentModificationException in CapacityScheduler's
    LeafQueue. (Rohith Sharmaks via ozawa)

    YARN-2019/EAR-1682. Retrospect on decision of making RM crashed if any
    exception throw in ZKRMStateStore. Contributed by Rohith Sharma K S

    YARN-3487. CapacityScheduler scheduler lock obtained unnecessarily when
    calling getQueue. Contributed by Jason Lowe.

    HDFS-8486. DN startup may cause severe data loss. Contributed by Daryn
    Sharp.

    HDFS-8270. create() always retried with hardcoded timeout when file already
    exists with open lease. (J.Andreina via vianayakumarb)

    YARN-3878. AsyncDispatcher can hang while stopping if it is configured for
    draining events on stop. (Varun Saxena via jianhe)

    YARN-3385. Fixed a race-condition in ResourceManager's ZooKeeper based
    state-store to avoid crashing on duplicate deletes. (Zhihai Xu via vinodkv)

    YARN-2136. Changed RMStateStore to ignore store opearations when fenced.
    (Varun Saxena via jianhe)

    YARN-2856. Fixed RMAppImpl to handle ATTEMPT_KILLED event at ACCEPTED state
    on app recovery. (Rohith Sharmaks via jianhe)

    YARN-2946. Fixed potential deadlock in RMStateStore. (Rohith Sharmaks via
    jianhe)

    YARN-2992. ZKRMStateStore crashes due to session expiry. (Karthik Kambatla
    via jianhe)

    YARN-3094. Reset timer for liveness monitors after RM recovery. (Jun Gong
    via jianhe)

    YARN-3369. Missing NullPointer check in AppSchedulingInfo causes RM to die.
    (Brahma Reddy Battula via wangda)

    YARN-3753. RM failed to come up with "java.io.IOException: Wait for
    ZKClient creation timed out”. (Jian He via xgong)

    YARN-3242. Asynchrony in ZK-close can lead to ZKRMStateStore watcher
    receiving events for old client. (Zhihai Xu via kasha)
    
    YARN-3469. ZKRMStateStore: Avoid setting watches that are not required.
    (Jun Gong via kasha)

    YARN-2605. RM HA Rest api endpoints doing redirect incorrectly. (Xuan Gong
    via stevel)

    YARN-3351. AppMaster tracking URL is broken in HA. (Anubhav Dhoot via
    kasha)

    YARN-3526. ApplicationMaster tracking URL is incorrectly redirected on a
    QJM cluster. (Weiwei Yang via xgong)
    
    YARN-3804. Both RM are on standBy state when kerberos user not in
    yarn.admin.acl (Varun Saxena via xgong)
    
    YARN-2865. Fixed RM to always create a new RMContext when transtions from
    StandBy to Active. (Rohith Sharmaks via jianhe)

    YARN-2713. "RM Home" link in NM should point to one of the RMs in an HA
    setup. (kasha)

    YARN-3999. RM hangs on draing events. (jianhe)

    HADOOP-12186. ActiveStandbyElector shouldn't call monitorLockNodeAsync
    multiple times (Contributed by zhihai xu)
    
    HDFS-8856. [2.2] Make LeaseManager#countPath O(1). (Arpit Agarwal)

    BUG-41834. DFSOutputstreamer does not log failed pipeline status. (Arpit
    Agarwal)

    HDFS-7980. Incremental BlockReport will dramatically slow down the startup
    of a namenode. Contributed by Walter Su.

    HDFS-7734. Class cast exception in NameNode#main. (Contriubuted by Yi Liu)

    BUG-42160. Backport HDFS-7712 to 2.2-maint. (Xiaobing Zhou)

    BUG-42484. Backport HDFS-8522 to 2.2-maint, Change heavily recorded NN logs
    from INFO to DEBUG level. (Xiaobing Zhou)

    BUG-42253. HDFS-8880. NameNode metrics logging. (Arpit Agarwal)

    HDFS-8549. Abort the balancer if an upgrade is in progress. (wang)

    HDFS-8818. Changes the global moveExecutor to per datanode executors and
    changes MAX_SIZE_TO_MOVE to be configurable.  (szetszwo)

    HDFS-8824. Do not use small blocks for balancing the cluster.  (szetszwo)

    HDFS-8883. NameNode Metrics : Add FSNameSystem lock Queue Length. (Anu
    Engineer via xyao)

    HDFS-4396. Add START_MSG/SHUTDOWN_MSG for ZKFC (Liang Xie via harsh)

    HDFS-7608: hdfs dfsclient newConnectedPeer has no write timeout (Xiaoyu Yao
    via Colin P. McCabe)

    HDFS-7928. Scanning blocks from disk during rolling upgrade startup takes a
    lot of time if disks are busy. Contributed by Rushabh Shah.

    HDFS-7933. fsck should also report decommissioning replicas. (Xiaoyu Yao
    via cnauroth)

    HDFS-8278. When computing max-size-to-move in Balancer, count only the
    storage with remaining >= default block size.  (szetszwo)

    HDFS-8826. In Balancer, add an option to specify the source node list so
    that balancer only selects blocks to move from those nodes.  (szetszwo)

    HDFS-8311. DataStreamer.transfer() should timeout the socket InputStream.
    (Esteban Gutierrez via Yongjun Zhang)

    HDFS-8046. Allow better control of getContentSummary (kihwal)

    BUG-41706. HDFS-5782 (BlockListAsLongs should take lists of Replicas rather
    than concrete classes) and HDFS-7435 (PB encoding of block reports is very
    inefficient).

    HDFS-7278. Add a command that allows sysadmins to manually trigger full
    block reports from a DN (cmccabe).

    HDFS-7533. Datanode sometimes does not shutdown on receiving upgrade
    shutdown command (Eric Payne via kihwal)

    HDFS-8038. PBImageDelimitedTextWriter#getEntry output HDFS path in
    platform-specific format. (Xiaoyu Yao via cnauroth)

    HDFS-7704. DN heartbeat to Active NN may be blocked and expire if
    connection to Standby NN continues to time out. Contributed by Rushabh
    Shah.

    HDFS-8163. Using monotonicNow for block report scheduling causes test
    failures on recently restarted systems. (Arpit Agarwal)

    HDFS-7635. Remove TestCorruptFilesJsp from branch-2. (Chris Nauroth)

    HDFS-7632. MiniDFSCluster configures DataNode data directories incorrectly
    if using more than 1 DataNode and more than 2 storage locations per
    DataNode. (Chris Nauroth)

    HDFS-8863. The remaining space check in BlockPlacementPolicyDefault is
    flawed. (Kihwal Lee via Yi Liu)

    HDFS-7915. The DataNode can sometimes allocate a ShortCircuitShm slot and
    fail to tell the DFSClient about it because of a network error. (Colin
    Patrick McCabe)

    HDFS-8070. Pre-HDFS-7915 DFSClient cannot use short circuit on post-
    HDFS-7915 DataNode. (Colin Patrick McCabe)

    HDFS-8595. TestCommitBlockSynchronization fails with NPE (Arpit Agarwal)

    BUG-43485. Truncate is not allowed in FSNameSystem causes a set of test
    failures (Anu Engineer)

    BUG-43487. BlockReportTestBase uses incorrect Directory Scan interval.
    (Arpit Agarwal)

    HDFS-8219. setStoragePolicy with folder behavior is different after cluster
    restart. (surendra singh lilhore via Xiaoyu Yao)

    HDFS-8055. NullPointerException when topology script is missing.
    Contributed by Anu Engineer.

    BUG-43802. HDFS-9009. Send metrics logs to NullAppender by default. (Arpit
    Agarwal)

    HADOOP-11595. Add default implementation for AbstractFileSystem#truncate.
    (yliu)

    HADOOP-11368. Fix SSLFactory truststore reloader thread leak in
    KMSClientProvider. (Arun Suresh via wang)

    HADOOP-11333. Fix deadlock in DomainSocketWatcher when the notification
    pipe is full. (zhaoyunjiong via cmccabe)

    HADOOP-11710. Make CryptoOutputStream behave like DFSOutputStream wrt
    synchronization. (Sean Busbey via yliu)

    HADOOP-11604. Prevent ConcurrentModificationException while closing domain
    sockets during shutdown of DomainSocketWatcher thread. (cnauroth)

    HADOOP-11482. Use correct UGI when KMSClientProvider is called by a proxy
    user. Contributed by Arun Suresh.

    HADOOP-11350. The size of header buffer of HttpServer is too small when
    HTTPS is enabled. (Benoy Antony via wheat9)

    HADOOP-11730. Regression: s3n read failure recovery broken. (Takenori Sato
    via stevel)

    HADOOP-11802. DomainSocketWatcher thread terminates sometimes after there
    is an I/O error during requestShortCircuitShm (cmccabe)

    HADOOP-8151. Error handling in snappy decompressor throws invalid
    exceptions. (Matt Foley via harsh)

    YARN-4092. Fixed UI redirection to print useful messages when both RMs are
    in standby mode. (Xuan Gong via jianhe)

    YARN-4101. RM should print alert messages if Zookeeper and Resourcemanager
    gets connection issue. (Xuan Gong via jianhe)

    YARN-3832. Resource Localization fails on a cluster due to existing cache
    directories (Brahma Reddy Battula via jlowe)

    YARN-2301. Improved yarn container command. (Naganarasimha G R via jianhe)

    YARN-3850. NM fails to read files from full disks which can lead to
    container logs being lost and other issues (Varun Saxena via jlowe)

    YARN-3832. Resource Localization fails on a cluster due to existing cache
    directories (Brahma Reddy Battula via jlowe)

    YARN-3585. NodeManager cannot exit on SHUTDOWN event triggered and NM
    recovery is enabled (Rohith Sharmaks via jlowe)

    YARN-3641. NodeManager: stopRecoveryStore() shouldn't be skipped when
    exceptions happen in stopping NM's sub-services. (Junping Du via jlowe)

    YARN-3055. Fixed ResourceManager's DelegationTokenRenewer to not stop token
    renewal of applications part of a bigger workflow. (Daryn Sharp via
    vinodkv)

    YARN-3238. Connection timeouts to nodemanagers are retried at multiple
    levels (Jason Lowe via xgong)

    YARN-3011. Possible IllegalArgumentException in ResourceLocalizationService
    might lead NM to crash. (Varun Saxena via jianhe)

    YARN-3978. Configurably turn off the saving of container info in Generic
    AHS (Eric Payne via jeagles)

    YARN-3942: Timeline store to read events from HDFS into 2.2-maint

    YARN-3222. Fixed NPE on RMNodeImpl#ReconnectNodeTransition when a node is
    reconnected with a different port. Contributed by Rohith Sharmaks

    YARN-2821/BUG-43232. Distributed shell app master becomes unresponsive
    sometimes.

    MAPREDUCE-6454. Fixed MapReduce to modify HADOOP_CLASSPATH to have
    distributed cache files so that child processes running hadoop scripts can
    access these files. Contributed by Junping Du.

    MAPREDUCE-6238. MR2 can't run local jobs with -libjars command options
    which is a regression from MR1 (zxu via rkanter)

    YARN-3654. ContainerLogsPage web UI should not have meta-refresh. (Xuan
    Gong)

    YARN-4087. Followup fixes after YARN-2019 regarding RM behavior when state-
    store error occurs. (Jian He via xgong)

    YARN-3197. Confusing log generated by CapacityScheduler (wangda)

    YARN-1984. LeveldbTimelineStore does not handle db exceptions properly
    (xgong)
   
    YARN-2165. Timeline server should validate the numeric configuration values
    (xgong)

    YARN-3207. secondary filter matches entites which do not have the key being
    filtered for. (xgong)

    YARN-3267. Timelineserver applies the ACL rules after applying the limit on
    the number of records. (xgong)

    YARN-3530. ATS throws exception on trying to filter results without
    otherinfo. (xgong)

    YARN-3448. Add Rolling Time To Lives Level DB Plugin Capabilities. (xgong)

    YARN-3207, YARN-3267, YARN-3530 & YARN-3448 to build on Java 6. (stevel)

    BUG-43686. TestDatanodeBlockScanner#testTruncatedBlockReport fails due to
    timeout (Anu Engineer)

    BUG-42698. HADOOP-12318. Expose underlying LDAP exceptions in
    SaslPlainServer. (Mike Yoder via atm)

    BUG-42934. HADOOP-12324. Better exception reporting in SaslPlainServer.
    (Mike Yoder via stevel)

    BUG-44875. HADOOP-12407. Test failing: hadoop.ipc.TestSaslRPC. (stevel)

    BUG-43658. HDFS-8995. Flaw in registration bookeeping can make DN die on
    reconnect. (Kihwal Lee via yliu)

    BUG-43789. HDFS-6945. BlockManager should remove a block from
    excessReplicateMap and decrement ExcessBlocks metric when the block is
    removed. (aajisaka)

    BUG-43801. HDFS-8939. Test(S)WebHdfsFileContextMainOperations failing on
    branch-2. (cnauroth).

    BUG-45096. HDFS-9128. TestWebHdfsFileContextMainOperations and
    TestSWebHdfsFileContextMainOperations fail due to invalid HDFS path on
    Windows. (cnauroth)

    HDFS-67. Fix compilation error on JDK 6 by avoiding call to
    InetSocketAddress#getHostString, which was added in JDK 7. (cnauroth)

    BUG-45092. HDFS-8554. TestDatanodeLayoutUpgrade fails on Windows.
    (cnauroth)

    BUG-45093. HADOOP-12438. TestLocalFileSystem tests can fail on Windows
    after HDFS-8767 fix for handling pipe. (cnauroth)

    BUG-45215. HADOOP-12089. StorageException complaining " no lease ID" when
    updating FolderLastModifiedTime in WASB. (Duo Xu via cnauroth).

    BUG-45216. HADOOP-12239. StorageException complaining " no lease ID" when
    updating FolderLastModifiedTime in WASB. (Duo Xu via cnauroth)

    BUG-44268. HDFS-8576. Lease recovery should return true if the lease can be
    released and the file can be closed. (J.Andreina via szetszwo)

    BUG-45259. HADOOP-11918. Listing an empty s3a root directory throws
    FileNotFound. (Lei (Eddy Xu) via cnauroth)

    BUG-45466. HDFS-9178. Slow datanode I/O can cause a wrong node to be marked
    bad. (Kihwal Lee)

    BUG-44495. HDFS-4366. Block Replication Policy Implementation May Skip
    Higher-Priority Blocks for Lower-Priority Blocks. (Derek Dagit via Kihwal
    Lee)

    BUG-44495. HDFS-9205. Do not schedule corrupt blocks for replication.
    (szetszwo)

    BUG-45254. HDFS-4660. Block corruption can happen during pipeline recovery.
    (Kihwal Lee)

    BUG-45263. Fix build break due to usage of JDK 1.7 API.

    BUG-45254. HDFS-8722. Optimize datanode writes for small writes and
    flushes. (Kihwal Lee)

    BUG-45254. HDFS-9220. Reading small file (< 512 bytes) that is open for
    append fails due to incorrect checksum. (Jing Zhao via Kihwal Lee)

    BUG-44834. HADOOP-11032. Replace use of Guava's Stopwatch with Hadoop's
    StopWatch. (ozawa)

    BUG-44834. HDFS-9107. Prevent NN's unrecoverable death spiral after full
    GC. (Daryn Sharp via Colin P. McCabe)

    BUG-46564. HDFS-9273. ACLs on root directory may be lost after NN restart.
    (Xiao Chen via cnauroth).

    BUG-46668. Addendum for HDFS-9184 to remove JDK 7 dependencies.
    (Contributed by Mingliang Liu and Arpit Agarwal)

    BUG-46049. MAPREDUCE-6442. Stack trace is missing when error occurs in
    client protocol provider's constructor (Chang Li via ozawa)

    BUG-43966. YARN-4105. Capacity Scheduler headroom for DRF is wrong (Chang
    Li via jlowe)

    BUG-46749. HDFS-7448. TestBookKeeperHACheckpoints fails in trunk build.
    (Akira AJISAKA via stevel)

    BUG-46749. HDFS-7097. Allow block reports to be processed during
    checkpointing on standby name node. (kihwal via wang)

    BUG-46682. HDFS-9305. Delayed heartbeat processing causes rapid storm of
    subsequent heartbeat messages (Arpit Agarwal)

    BUG-46755. HDFS-9106. Transfer failure during pipeline recovery causes
    permanent write failures. (Kihwal Lee)

    BUG-46846. SafeMode forceExit option is not working (Contributed by Anu
    Engineer)

    BUG-46858. HDFS-8950. NameNode refresh doesn't remove DataNodes that are no
    longer in the allowed list. (Daniel Templeton via cmccabe).

    BUG-43821/YARN-4313. Race condition in MiniMRYarnCluster when getting
    history server address. (Jian He via Xuan Gong)

    BUG-46919. HADOOP-11000. HAServiceProtocol's health state is incorrectly
    transitioned to SERVICE_NOT_RESPONDING (Contributed by Ming Ma)

    BUG-46921. HDFS-9142. Separating Configuration object for namenode(s) in
    MiniDFSCluster. (Siqi Li via mingma)

    BUG-42275. HDFS-9311. Support optional offload of NameNode HA service
    health checks to a separate RPC server. (cnauroth)

    BUG-46743. HDFS-9083. Replication violates block placement policy. (Rushabh
    S Shah via kihwal).

    BUG-40325. Fixed a hang problem in DistributedShell. (Varun Vasudev)

    BUG-47096. HDFS-9343. Empty caller context considered invalid. (Mingliang
    Liu via Arpit Agarwal)

    BUG-47113. HDFS-7931. DistributedFileSystem should not look for keyProvider
    in cache if Encryption is disabled (asuresh)

    BUG-47100. Fix TestOfflineEditsViewer and TestDFSInotifyEventInputStream.
    (Arpit Agarwal)

    HADOOP-12186. ActiveStandbyElector shouldn't call monitorLockNodeAsync
    multiple times (Contributed by zhihai xu)

    BUG-47201. Fix Debian build break in DNS.java (Arpit Agarwal)

    YARN-3766. Fixed the apps table column error of generic history web UI.
    (Xuan Gong via zjshen)

    BUG-47244. HDFS-9354. Fix TestBalancer#testBalancerWithZeroThreadsForMove
    on Windows. (Xiaoyu Yao via cnauroth)

    BUG-47218. HADOOP-12542. TestDNS fails on Windows after HADOOP-12437.
    (cnauroth).

    BUG-47216. HDFS-9362. TestAuditLogger#testAuditLoggerWithCallContext
    assumes Unix line endings, fails on Windows. (cnauroth).

    BUG-47474. HDFS-9384. TestWebHdfsContentLength intermittently hangs and
    fails due to TCP conversation mismatch between client and server.
    (cnauroth).

    BUG-47432. HADOOP-12334. Change Mode Of Copy Operation of HBase WAL
    Archiving to bypass Azure Storage Throttling after retries. (Gaurav Kanade
    via Chris Nauroth).

    BUG-47468. HDFS-8785. TestDistributedFileSystem is failing in trunk.
    (Xiaoyu Yao)

    BUG-47372. TestDecomission fails in 2.2-maint. (Arpit Agarwal)

    BUG-47448. HDFS-4937. ReplicationMonitor can infinite-loop in
    BlockPlacementPolicyDefault#chooseRandom. (kihwal)

    BUG-47264. HADOOP-11685. StorageException complaining " no lease ID" during
    HBase distributed log splitting. (Duo Xu via Chris Nauroth).

    BUG-26978. HDFS-6481. DatanodeManager#getDatanodeStorageInfos() should check
    the length of storageIDs. (szetszwo via Arpit Agarwal)

    MAPREDUCE-6302. (BUG-47641) Backport preempt reducers after a configurable 
    timeout irrespective of headroom. (Karthik Kambatla)

    BUG-47098. HDFS-8626. Reserved RBW space is not released if creation of
    RBW File fails. (Kanaka Kumar Avvaru via Arpit Agarwal)

    YARN-3522. Fixed DistributedShell to instantiate TimeLineClient as the
    correct user. (Zhijie Shen via jianhe)

    YARN-4347. Resource manager fails with Null pointer exception. (Jian He
    via wangda)
    
    BUG-47767. YARN-4344. NMs reconnecting with changed capabilities
    can lead to wrong cluster resource calculations. (Varun Vasudev)

    BUG-47982. Update CallerContext name for MR app master / task (wangda)

    BUG-56434. MAPREDUCE-6680. JHS UserLogDir scan algorithm sometime could skip directory
    with update in CloudFS (Azure FileSystem, S3, etc). (Junping Du via jianhe)

    YARN-234. Remove deprecated AHS property for Window's configuration. Junping Du.
